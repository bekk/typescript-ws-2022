{"ast":null,"code":"import { NEW_FOCUS, newFocus } from './solver';\nimport { getAllAffectedNodes } from './utils/all-affected';\nimport { getAllTabbableNodes, getTabbableNodes } from './utils/DOMutils';\nimport { pickFirstFocus } from './utils/firstFocus';\nimport { isDefined, isNotAGuard } from './utils/is';\nimport { allParentAutofocusables, getTopCommonParent } from './utils/parenting';\n\nvar findAutoFocused = function (autoFocusables) {\n  return function (node) {\n    return node.autofocus || node.dataset && !!node.dataset.autofocus || autoFocusables.indexOf(node) >= 0;\n  };\n};\n\nvar reorderNodes = function (srcNodes, dstNodes) {\n  var remap = new Map();\n  dstNodes.forEach(function (entity) {\n    return remap.set(entity.node, entity);\n  });\n  return srcNodes.map(function (node) {\n    return remap.get(node);\n  }).filter(isDefined);\n};\n\nexport var getFocusMerge = function (topNode, lastNode) {\n  var activeElement = document && document.activeElement;\n  var entries = getAllAffectedNodes(topNode).filter(isNotAGuard);\n  var commonParent = getTopCommonParent(activeElement || topNode, topNode, entries);\n  var visibilityCache = new Map();\n  var anyFocusable = getAllTabbableNodes(entries, visibilityCache);\n  var innerElements = getTabbableNodes(entries, visibilityCache).filter(function (_a) {\n    var node = _a.node;\n    return isNotAGuard(node);\n  });\n\n  if (!innerElements[0]) {\n    innerElements = anyFocusable;\n\n    if (!innerElements[0]) {\n      return undefined;\n    }\n  }\n\n  var outerNodes = getAllTabbableNodes([commonParent], visibilityCache).map(function (_a) {\n    var node = _a.node;\n    return node;\n  });\n  var orderedInnerElements = reorderNodes(outerNodes, innerElements);\n  var innerNodes = orderedInnerElements.map(function (_a) {\n    var node = _a.node;\n    return node;\n  });\n  var newId = newFocus(innerNodes, outerNodes, activeElement, lastNode);\n\n  if (newId === NEW_FOCUS) {\n    var autoFocusable = anyFocusable.map(function (_a) {\n      var node = _a.node;\n      return node;\n    }).filter(findAutoFocused(allParentAutofocusables(entries, visibilityCache)));\n    return {\n      node: autoFocusable && autoFocusable.length ? pickFirstFocus(autoFocusable) : pickFirstFocus(innerNodes)\n    };\n  }\n\n  if (newId === undefined) {\n    return newId;\n  }\n\n  return orderedInnerElements[newId];\n};","map":{"version":3,"names":["NEW_FOCUS","newFocus","getAllAffectedNodes","getAllTabbableNodes","getTabbableNodes","pickFirstFocus","isDefined","isNotAGuard","allParentAutofocusables","getTopCommonParent","findAutoFocused","autoFocusables","node","autofocus","dataset","indexOf","reorderNodes","srcNodes","dstNodes","remap","Map","forEach","entity","set","map","get","filter","getFocusMerge","topNode","lastNode","activeElement","document","entries","commonParent","visibilityCache","anyFocusable","innerElements","_a","undefined","outerNodes","orderedInnerElements","innerNodes","newId","autoFocusable","length"],"sources":["/Users/ingeborg/projects/code/typescript-ws-2022/node_modules/focus-lock/dist/es2015/focusMerge.js"],"sourcesContent":["import { NEW_FOCUS, newFocus } from './solver';\nimport { getAllAffectedNodes } from './utils/all-affected';\nimport { getAllTabbableNodes, getTabbableNodes } from './utils/DOMutils';\nimport { pickFirstFocus } from './utils/firstFocus';\nimport { isDefined, isNotAGuard } from './utils/is';\nimport { allParentAutofocusables, getTopCommonParent } from './utils/parenting';\nvar findAutoFocused = function (autoFocusables) { return function (node) {\n    return node.autofocus || (node.dataset && !!node.dataset.autofocus) || autoFocusables.indexOf(node) >= 0;\n}; };\nvar reorderNodes = function (srcNodes, dstNodes) {\n    var remap = new Map();\n    dstNodes.forEach(function (entity) { return remap.set(entity.node, entity); });\n    return srcNodes.map(function (node) { return remap.get(node); }).filter(isDefined);\n};\nexport var getFocusMerge = function (topNode, lastNode) {\n    var activeElement = (document && document.activeElement);\n    var entries = getAllAffectedNodes(topNode).filter(isNotAGuard);\n    var commonParent = getTopCommonParent(activeElement || topNode, topNode, entries);\n    var visibilityCache = new Map();\n    var anyFocusable = getAllTabbableNodes(entries, visibilityCache);\n    var innerElements = getTabbableNodes(entries, visibilityCache).filter(function (_a) {\n        var node = _a.node;\n        return isNotAGuard(node);\n    });\n    if (!innerElements[0]) {\n        innerElements = anyFocusable;\n        if (!innerElements[0]) {\n            return undefined;\n        }\n    }\n    var outerNodes = getAllTabbableNodes([commonParent], visibilityCache).map(function (_a) {\n        var node = _a.node;\n        return node;\n    });\n    var orderedInnerElements = reorderNodes(outerNodes, innerElements);\n    var innerNodes = orderedInnerElements.map(function (_a) {\n        var node = _a.node;\n        return node;\n    });\n    var newId = newFocus(innerNodes, outerNodes, activeElement, lastNode);\n    if (newId === NEW_FOCUS) {\n        var autoFocusable = anyFocusable\n            .map(function (_a) {\n            var node = _a.node;\n            return node;\n        })\n            .filter(findAutoFocused(allParentAutofocusables(entries, visibilityCache)));\n        return {\n            node: autoFocusable && autoFocusable.length ? pickFirstFocus(autoFocusable) : pickFirstFocus(innerNodes),\n        };\n    }\n    if (newId === undefined) {\n        return newId;\n    }\n    return orderedInnerElements[newId];\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}